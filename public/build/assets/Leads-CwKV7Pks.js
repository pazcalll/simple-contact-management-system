import{d as Z,n as ee,y as m,C as L,z as se,g as x,o as d,w as a,b as i,e as t,i as te,A as le,a as g,h as S,u as o,B as ae,t as b,f as n,F as E,r as V}from"./app-BIvNjbzt.js";import{_ as oe}from"./SubmissionAlert.vue_vue_type_script_setup_true_lang-DIlNvm4v.js";import{L as ne,_ as ue,a as P}from"./GroupedSelect.vue_vue_type_script_setup_true_lang-yuc24DOd.js";import{_ as re,P as de,a as ie,h as fe,b as ce}from"./TablePagination.vue_vue_type_script_setup_true_lang-Doo14GiW.js";import{_ as pe}from"./ItemSelect.vue_vue_type_script_setup_true_lang-DM-KagZa.js";import{_ as j}from"./index-C-DuyO8D.js";import{e as me}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BZWZnH_P.js";import{_ as q}from"./Input.vue_vue_type_script_setup_true_lang-ByD1ommd.js";import{_ as U}from"./Label.vue_vue_type_script_setup_true_lang-xZOwMxLN.js";import{_ as _e,a as ve,b as B,c as h,d as ge,e as k}from"./TableHeader.vue_vue_type_script_setup_true_lang-BlWVPBk-.js";import{b as Se,_ as be}from"./AppLayout.vue_vue_type_script_setup_true_lang-D-2xud0r.js";import{g as ke}from"./leads-80jE1Bc1.js";import"./Alert.vue_vue_type_script_setup_true_lang-B6jaV5fk.js";import"./SelectContent.vue_vue_type_script_setup_true_lang-Bm_23Tpb.js";import"./useForwardPropsEmits-DzH0n8Iq.js";import"./useForwardExpose-CIw8BA15.js";import"./RovingFocusGroup-VGpyM4gS.js";import"./x-BpMgLEIA.js";import"./check-CdKOTloA.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CO0VwofJ.js";const we={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ye={key:0,class:"text-red-500"},xe={class:"grid grid-cols-5 gap-2"},he={class:"w-full"},$e={key:0,class:"text-red-500"},Ce={class:"w-full"},Ne={key:0,class:"text-red-500"},Ae={class:"flex w-full items-center justify-start"},Ie={class:"flex items-center"},Le={class:"w-full rounded-lg border"},Ue={class:"text-blue-500"},Be={key:0},Fe={class:"flex w-full justify-center"},De={class:"w-full max-w-[14rem]"},ts=Z({__name:"Leads",setup(Ee){const $=ee(),c=m($.props.leads),C=m(!1),N=m(!1),u=m({isShow:!1,message:null}),A=m(!1),r=m([]),w=m(null),y=m(null),O=$.props.staffs,I=$.props.leadStatuses,F=m(null),p=L({note:null});$.props.flash.success&&(u.value.isShow=!0,u.value.message=$.props.flash.success);const _=L({lead_status_id:null,lead_ids:[],staff_id:null,is_unassign:"off"}),M=async()=>{var l;N.value=!0,p.submit("post",`/leads/${(l=y.value)==null?void 0:l.id}/notes`,{preserveScroll:!0,preserveState:!0,onBefore:e=>{console.log(e)},onSuccess:()=>{C.value=!1,u.value.isShow=!0,u.value.message="Note added successfully"},onFinish:()=>{console.log("finished"),N.value=!1},onError:e=>{console.log(e),u.value.isShow=!0,u.value.message="Failed to add note"}})},T=async l=>{const e=I.find(v=>v.id==l);w.value=e==null?void 0:e.id,console.log(w.value)},Q=l=>{r.value?r.value.includes(l)||(r.value=[...r.value,l]):r.value=[l]},z=l=>{r.value&&(r.value=r.value.filter(e=>e!==l),r.value.length===0&&(r.value=[]))},D=l=>r.value.includes(l),G=l=>{const e=D(l);e?z(l):e?console.log("unidentified action"):Q(l)},J=async()=>{var e;const l=await ke(((e=y.value)==null?void 0:e.id)??0);if(l&&typeof l=="object"&&"message"in l){console.log(l);return}return l},R=(l,e)=>{const v=c.value.data.find(f=>f.id===l);L({lead_id:v==null?void 0:v.id,lead_status_id:e}).patch("/leads/update-lead-status",{preserveScroll:!0,preserveState:!0,onError:f=>{console.log(f)},onSuccess:f=>{u.value.isShow=!0;const X=f.props.flash;u.value.message=X.success||"Lead status updated successfully"}})},Y=()=>{_.lead_ids=r.value,_.lead_status_id=w.value,_.staff_id=F.value,_.is_unassign=_.is_unassign==="on"?"on":"off",_.patch("/team-leaders/leads/bulk-assign-leads",{preserveState:!1,onError:l=>{console.log(l)},onSuccess:l=>{u.value.isShow=!0;const e=l.props.flash;u.value.message=e.success||"Bulk action completed successfully",A.value=!1,r.value=[],w.value=null}})},H=async l=>{y.value=l,C.value=!0,y.value&&(y.value.lead_notes=await J())},K=()=>ce({pagination:c,endpoint:"/team-leaders/leads"}),W=()=>fe({pagination:c,endpoint:"/team-leaders/leads"});return(l,e)=>{const v=se("PlusSquare");return d(),x(be,null,{default:a(()=>[i("div",we,[t(oe,{isShow:u.value.isShow,message:u.value.message,"onUpdate:isShow":e[0]||(e[0]=s=>u.value.isShow=s)},null,8,["isShow","message"]),t(re,{open:C.value,selectedLead:y.value,"onUpdate:open":e[2]||(e[2]=s=>C.value=s)},{content:a(()=>[i("form",{onSubmit:te(M,["prevent"])},[e[11]||(e[11]=i("p",null,"Notes:",-1)),le(i("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>o(p).note=s),class:"w-full rounded-lg border-2 border-gray-300 p-2"},null,512),[[ae,o(p).note]]),o(p).errors.note?(d(),g("p",ye,b(o(p).errors.note),1)):S("",!0),t(me,{class:"sm:justify-start"},{default:a(()=>[N.value?S("",!0):(d(),x(j,{key:0,type:"submit",variant:"default"},{default:a(()=>[t(o(de)),e[10]||(e[10]=n(" Add Note "))]),_:1})),N.value?(d(),x(o(ne),{key:1,class:"animate-spin"})):S("",!0)]),_:1})],32)]),_:1},8,["open","selectedLead"]),i("div",xe,[t(ue,{onSubmit:Y,open:A.value,"onUpdate:open":e[6]||(e[6]=s=>A.value=s)},{trigger:a(()=>[t(j,{variant:"secondary",class:"w-full"},{default:a(()=>[t(v),e[12]||(e[12]=n("Bulk Action"))]),_:1})]),content:a(()=>[i("div",he,[t(U,{class:"mb-1"},{default:a(()=>e[13]||(e[13]=[n("Status")])),_:1}),t(P,{"selected-id":w.value,"onUpdate:selectedId":[e[3]||(e[3]=s=>w.value=s),T],placeholder:"Select lead status",convertable:o(I)},null,8,["selected-id","convertable"]),o(p).errors.note?(d(),g("p",$e,b(o(p).errors.note),1)):S("",!0)]),i("div",Ce,[t(U,{class:"mb-1"},{default:a(()=>e[14]||(e[14]=[n("Staff")])),_:1}),t(pe,{placeholder:"Select staff",items:o(O),"onUpdate:selectedId":e[4]||(e[4]=s=>F.value=s)},null,8,["items"]),o(p).errors.note?(d(),g("p",Ne,b(o(p).errors.note),1)):S("",!0)]),i("div",Ae,[i("div",Ie,[t(U,{class:"ml-2 cursor-pointer"},{default:a(()=>[t(q,{type:"checkbox",class:"min-h-5 min-w-5",onClick:e[5]||(e[5]=s=>o(_).is_unassign=s.target.checked?"on":"off")}),e[15]||(e[15]=n(" Unassign "))]),_:1})])])]),_:1},8,["open"])]),i("div",Le,[t(_e,{class:"w-full"},{default:a(()=>[t(ve,{class:"text-[12pt]"},{default:a(()=>[t(B,{class:"bg-[#F5F5F4] dark:bg-[#1C1C1A]"},{default:a(()=>[t(h,null,{default:a(()=>e[16]||(e[16]=[n("#")])),_:1}),t(h,null,{default:a(()=>e[17]||(e[17]=[n("Name")])),_:1}),t(h,null,{default:a(()=>e[18]||(e[18]=[n("Mobile")])),_:1}),t(h,null,{default:a(()=>e[19]||(e[19]=[n("Email")])),_:1}),t(h,null,{default:a(()=>e[20]||(e[20]=[n("Status")])),_:1}),t(h,null,{default:a(()=>e[21]||(e[21]=[n("Assignees")])),_:1})]),_:1})]),_:1}),t(ge,null,{default:a(()=>[(d(!0),g(E,null,V(c.value.data,s=>(d(),x(B,{key:s==null?void 0:s.id},{default:a(()=>[t(k,null,{default:a(()=>[t(q,{type:"checkbox",class:"cursor-pointer",onClick:f=>G(s.id),checked:D(s.id)},null,8,["onClick","checked"])]),_:2},1024),t(k,{onClick:()=>H(s),class:"cursor-pointer"},{default:a(()=>[i("u",Ue,b(s.name),1)]),_:2},1032,["onClick"]),t(k,null,{default:a(()=>[n(b(s.mobile_number),1)]),_:2},1024),t(k,null,{default:a(()=>[n(b(s.email),1)]),_:2},1024),t(k,null,{default:a(()=>[(d(),x(P,{selectedId:s.lead_status_id,placeholder:"Select lead status",convertable:o(I),"onUpdate:selectedId":f=>R(s.id,f),key:s.id},null,8,["selectedId","convertable","onUpdate:selectedId"]))]),_:2},1024),t(k,null,{default:a(()=>[(d(!0),g(E,null,V(s.users,f=>(d(),g("ul",{key:f.id,class:"list-inside list-disc"},[f.roles[0].name==o(Se)?(d(),g("li",Be,b(f.name),1)):S("",!0)]))),128))]),_:2},1024)]),_:2},1024))),128)),c.value.data.length<1?(d(),x(B,{key:0},{default:a(()=>[t(k,{colspan:4,class:"w-full text-center"},{default:a(()=>e[22]||(e[22]=[n(" Your leads bucket empty ")])),_:1})]),_:1})):S("",!0)]),_:1})]),_:1})]),i("div",Fe,[i("div",De,[t(ie,{current_page:c.value.current_page,last_page:c.value.last_page,per_page:c.value.per_page,next:K,prev:W,"onUpdate:current_page":e[7]||(e[7]=s=>c.value.current_page=s),"onUpdate:per_page":e[8]||(e[8]=s=>c.value.per_page=s),"onUpdate:last_page":e[9]||(e[9]=s=>c.value.last_page=s)},null,8,["current_page","last_page","per_page"])])])])]),_:1})}}});export{ts as default};

import{d as Z,n as ee,y as m,C as I,z as se,g as x,o as d,w as a,b as i,e as l,i as le,A as te,a as g,h as S,u as o,B as ae,t as b,f as n,F as D,r as T}from"./app-DDJy9goU.js";import{_ as oe}from"./SubmissionAlert.vue_vue_type_script_setup_true_lang-E_-Eu6rW.js";import{L as ne,_ as ue,a as V}from"./GroupedSelect.vue_vue_type_script_setup_true_lang-CnCVRtS-.js";import{_ as re,P as de,a as ie,h as fe,b as pe}from"./TablePagination.vue_vue_type_script_setup_true_lang-BnAYzjB-.js";import{_ as ce}from"./ItemSelect.vue_vue_type_script_setup_true_lang-BBXyLo2K.js";import{_ as O}from"./index-USgevw8Q.js";import{e as me}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-C0ZMzQgj.js";import{_ as P}from"./Input.vue_vue_type_script_setup_true_lang-BR0yeles.js";import{_ as U}from"./Label.vue_vue_type_script_setup_true_lang-Bcddyw4y.js";import{_ as _e,a as ve,b as B,c as $,d as ge,e as k}from"./TableHeader.vue_vue_type_script_setup_true_lang-CABqKlZN.js";import{a as Se,b as be,_ as ke}from"./AppLayout.vue_vue_type_script_setup_true_lang-CQI-9P8Z.js";import{g as ye}from"./leads-80jE1Bc1.js";import"./Alert.vue_vue_type_script_setup_true_lang-C50XWpOc.js";import"./SelectContent.vue_vue_type_script_setup_true_lang-BZ19EPQo.js";import"./useForwardPropsEmits-Dw8SCXUW.js";import"./useForwardExpose-D31GOZNC.js";import"./RovingFocusGroup-D0KMisn-.js";import"./x-BC2tDXyL.js";import"./check-R1dftIXv.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DRzWBEcr.js";const we={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},xe={key:0,class:"text-red-500"},$e={class:"grid grid-cols-5 gap-2"},he={class:"w-full"},Le={key:0,class:"text-red-500"},Ae={class:"w-full"},Ce={key:0,class:"text-red-500"},Ne={class:"flex w-full items-center justify-start"},Ie={class:"flex items-center"},Ue={class:"w-full rounded-lg border"},Be={class:"text-blue-500"},Ee={key:0},Fe={class:"flex w-full justify-center"},De={class:"w-full max-w-[14rem]"},ts=Z({__name:"Leads",setup(Te){const h=ee(),f=m(h.props.leads);console.log(h.props.flash);const L=m(!1),A=m(!1),p=m({isShow:!1,message:null}),C=m(!1),u=m([]),y=m(null),w=m(null),j=h.props.teamLeaders,N=h.props.leadStatuses,E=m(null),c=I({note:null}),_=I({lead_status_id:null,lead_ids:[],team_leader_id:null,is_unassign:"off"}),q=async()=>{var t;A.value=!0,c.submit("post",`/leads/${(t=w.value)==null?void 0:t.id}/notes`,{preserveScroll:!0,preserveState:!0,onBefore:e=>{console.log(e)},onSuccess:()=>{L.value=!1,p.value.isShow=!0,p.value.message="Note added successfully"},onFinish:()=>{console.log("finished"),A.value=!1},onError:e=>{console.log(e),p.value.isShow=!0,p.value.message="Failed to add note"}})},M=async t=>{const e=N.find(v=>v.id==t);y.value=e==null?void 0:e.id,console.log(y.value)},R=t=>{u.value?u.value.includes(t)||(u.value=[...u.value,t]):u.value=[t]},Q=t=>{u.value&&(u.value=u.value.filter(e=>e!==t),u.value.length===0&&(u.value=[]))},F=t=>u.value.includes(t),z=t=>{const e=F(t);e?Q(t):e?console.log("unidentified action"):R(t)},G=async()=>{var e;const t=await ye(((e=w.value)==null?void 0:e.id)??0);if(t&&typeof t=="object"&&"message"in t){console.log(t);return}return t},J=(t,e)=>{const v=f.value.data.find(r=>r.id===t);I({lead_id:v==null?void 0:v.id,lead_status_id:e}).patch("/leads/update-lead-status",{preserveScroll:!0,preserveState:!0,onError:r=>{console.log(r)},onSuccess:r=>{p.value.isShow=!0;const X=r.props.flash;p.value.message=X.success||"Lead status updated successfully"}})},Y=()=>{_.lead_ids=u.value,_.lead_status_id=y.value,_.team_leader_id=E.value,_.is_unassign=_.is_unassign==="on"?"on":"off",_.patch("/supervisors/leads/bulk-assign-leads",{preserveState:!1,onError:t=>{console.log(t)},onSuccess:t=>{p.value.isShow=!0;const e=t.props.flash;p.value.message=e.success||"Bulk action completed successfully",C.value=!1,u.value=[],y.value=null}})},H=async t=>{w.value=t,L.value=!0,w.value&&(w.value.lead_notes=await G())},K=()=>pe({pagination:f,endpoint:"/supervisors/leads"}),W=()=>fe({pagination:f,endpoint:"/supervisors/leads"});return(t,e)=>{const v=se("PlusSquare");return d(),x(ke,null,{default:a(()=>[i("div",we,[l(oe,{isShow:p.value.isShow,message:p.value.message,"onUpdate:isShow":e[0]||(e[0]=s=>p.value.isShow=s)},null,8,["isShow","message"]),l(re,{open:L.value,selectedLead:w.value,"onUpdate:open":e[2]||(e[2]=s=>L.value=s)},{content:a(()=>[i("form",{onSubmit:le(q,["prevent"])},[e[11]||(e[11]=i("p",null,"Notes:",-1)),te(i("textarea",{"onUpdate:modelValue":e[1]||(e[1]=s=>o(c).note=s),class:"w-full rounded-lg border-2 border-gray-300 p-2"},null,512),[[ae,o(c).note]]),o(c).errors.note?(d(),g("p",xe,b(o(c).errors.note),1)):S("",!0),l(me,{class:"sm:justify-start"},{default:a(()=>[A.value?S("",!0):(d(),x(O,{key:0,type:"submit",variant:"default"},{default:a(()=>[l(o(de)),e[10]||(e[10]=n(" Add Note "))]),_:1})),A.value?(d(),x(o(ne),{key:1,class:"animate-spin"})):S("",!0)]),_:1})],32)]),_:1},8,["open","selectedLead"]),i("div",$e,[l(ue,{onSubmit:Y,open:C.value,"onUpdate:open":e[6]||(e[6]=s=>C.value=s)},{trigger:a(()=>[l(O,{variant:"secondary",class:"w-full"},{default:a(()=>[l(v),e[12]||(e[12]=n("Bulk Action"))]),_:1})]),content:a(()=>[i("div",he,[l(U,{class:"mb-1"},{default:a(()=>e[13]||(e[13]=[n("Status")])),_:1}),l(V,{"selected-id":y.value,"onUpdate:selectedId":[e[3]||(e[3]=s=>y.value=s),M],placeholder:"Select lead status",convertable:o(N)},null,8,["selected-id","convertable"]),o(c).errors.note?(d(),g("p",Le,b(o(c).errors.note),1)):S("",!0)]),i("div",Ae,[l(U,{class:"mb-1"},{default:a(()=>e[14]||(e[14]=[n("Team Leader")])),_:1}),l(ce,{placeholder:"Select team leader",items:o(j),"onUpdate:selectedId":e[4]||(e[4]=s=>E.value=s)},null,8,["items"]),o(c).errors.note?(d(),g("p",Ce,b(o(c).errors.note),1)):S("",!0)]),i("div",Ne,[i("div",Ie,[l(U,{class:"ml-2 cursor-pointer"},{default:a(()=>[l(P,{type:"checkbox",class:"shadow-none",onClick:e[5]||(e[5]=s=>o(_).is_unassign=s.target.checked?"on":"off")}),e[15]||(e[15]=n(" Unassign "))]),_:1})])])]),_:1},8,["open"])]),i("div",Ue,[l(_e,{class:"w-full"},{default:a(()=>[l(ve,{class:"text-[12pt]"},{default:a(()=>[l(B,{class:"bg-[#F5F5F4] dark:bg-[#1C1C1A]"},{default:a(()=>[l($,null,{default:a(()=>e[16]||(e[16]=[n("#")])),_:1}),l($,null,{default:a(()=>e[17]||(e[17]=[n("Name")])),_:1}),l($,null,{default:a(()=>e[18]||(e[18]=[n("Mobile")])),_:1}),l($,null,{default:a(()=>e[19]||(e[19]=[n("Email")])),_:1}),l($,null,{default:a(()=>e[20]||(e[20]=[n("Status")])),_:1}),l($,null,{default:a(()=>e[21]||(e[21]=[n("Assignees")])),_:1})]),_:1})]),_:1}),l(ge,null,{default:a(()=>[(d(!0),g(D,null,T(f.value.data,s=>(d(),x(B,{key:s==null?void 0:s.id},{default:a(()=>[l(k,null,{default:a(()=>[l(P,{type:"checkbox",class:"cursor-pointer",onClick:r=>z(s.id),checked:F(s.id)},null,8,["onClick","checked"])]),_:2},1024),l(k,{onClick:()=>H(s),class:"cursor-pointer"},{default:a(()=>[i("u",Be,b(s.name),1)]),_:2},1032,["onClick"]),l(k,null,{default:a(()=>[n(b(s.mobile_number),1)]),_:2},1024),l(k,null,{default:a(()=>[n(b(s.email),1)]),_:2},1024),l(k,null,{default:a(()=>[(d(),x(V,{selectedId:s.lead_status_id,placeholder:"Select lead status",convertable:o(N),"onUpdate:selectedId":r=>J(s.id,r),key:s.id},null,8,["selectedId","convertable","onUpdate:selectedId"]))]),_:2},1024),l(k,null,{default:a(()=>[(d(!0),g(D,null,T(s.users,r=>(d(),g("ul",{key:r.id,class:"list-inside list-disc"},[r.roles[0].name==o(Se)||r.roles[0].name==o(be)?(d(),g("li",Ee,b(r.name),1)):S("",!0)]))),128))]),_:2},1024)]),_:2},1024))),128)),f.value.data.length<1?(d(),x(B,{key:0},{default:a(()=>[l(k,{colspan:4,class:"w-full text-center"},{default:a(()=>e[22]||(e[22]=[n(" Your leads bucket empty ")])),_:1})]),_:1})):S("",!0)]),_:1})]),_:1})]),i("div",Fe,[i("div",De,[l(ie,{current_page:f.value.current_page,last_page:f.value.last_page,per_page:f.value.per_page,next:K,prev:W,"onUpdate:current_page":e[7]||(e[7]=s=>f.value.current_page=s),"onUpdate:per_page":e[8]||(e[8]=s=>f.value.per_page=s),"onUpdate:last_page":e[9]||(e[9]=s=>f.value.last_page=s)},null,8,["current_page","last_page","per_page"])])])])]),_:1})}}});export{ts as default};

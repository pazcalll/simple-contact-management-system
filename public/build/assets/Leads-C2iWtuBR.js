import{d as X,n as Y,y as p,C as B,z as H,g as b,o as f,w as l,b as i,e as a,i as K,A as W,a as I,h as k,u,B as Z,t as y,f as r,P as ee,F as se,r as te}from"./app-DDH9-M8F.js";import{_ as ae}from"./SubmissionAlert.vue_vue_type_script_setup_true_lang-CEAN8wGM.js";import{L as le,_ as oe,a as j}from"./GroupedSelect.vue_vue_type_script_setup_true_lang-Drq5abIC.js";import{_ as ne,P as ue,a as re,h as de,b as ie}from"./TablePagination.vue_vue_type_script_setup_true_lang-BNkSDP0w.js";import{_ as L}from"./index-Bl7ULf9p.js";import{e as fe}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-nlN60pnD.js";import{_ as ce}from"./Input.vue_vue_type_script_setup_true_lang-DRq4L5js.js";import{_ as pe}from"./Label.vue_vue_type_script_setup_true_lang-C1s4DYKS.js";import{_ as me,a as _e,b as P,c as x,d as ve,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-C-y_m1x9.js";import{_ as ge}from"./AppLayout.vue_vue_type_script_setup_true_lang-DB6ZMh0f.js";import{C as Se}from"./circle-plus-214mwmPS.js";import"./Alert.vue_vue_type_script_setup_true_lang-BDlI-3JF.js";import"./SelectContent.vue_vue_type_script_setup_true_lang-diDvTw5A.js";import"./useForwardPropsEmits-DhJmBs81.js";import"./useForwardExpose-fh6Ok7He.js";import"./RovingFocusGroup-B1ONIDe3.js";import"./x-CmkwNOn8.js";import"./check-CzJqFMvt.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DpgiMkX7.js";const be=async F=>{const v=await fetch(`/staffs/leads/${F}/notes`,{headers:{"X-Request-Format":"json"}});let o=null;return v.ok?(o=await v.json(),o):await v.json()},we={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},ke={key:0,class:"text-red-500"},ye={class:"grid grid-cols-5 gap-2"},xe={class:"w-full"},$e={key:0,class:"text-red-500"},he={class:"w-full rounded-lg border"},Ce={class:"text-blue-500"},Ne={class:"flex w-full justify-center"},Ae={class:"w-full max-w-[14rem]"},Xe=X({__name:"Leads",setup(F){const v=Y(),o=p(v.props.leads),$=p(!1),h=p(!1),m=p({isShow:!1,message:null}),C=p(!1),n=p([]),g=p(null),S=p(null),N=v.props.leadStatuses,_=B({note:null}),A=B({lead_status_id:null,lead_ids:[]}),D=async()=>{var s;h.value=!0,_.submit("post",`/staffs/leads/${(s=S.value)==null?void 0:s.id}/notes`,{onBefore:e=>{console.log(e)},onSuccess:()=>{$.value=!1},onFinish:()=>{h.value=!1}})},V=async s=>{const e=N.find(d=>d.id==s);g.value=e==null?void 0:e.id,console.log(g.value)},q=s=>{n.value?n.value.includes(s)||(n.value=[...n.value,s]):n.value=[s]},E=s=>{n.value&&(n.value=n.value.filter(e=>e!==s),n.value.length===0&&(n.value=[]))},U=s=>n.value.includes(s),M=s=>{const e=U(s);e?E(s):e?console.log("unidentified action"):q(s)},O=async()=>{var e;const s=await be(((e=S.value)==null?void 0:e.id)??0);if(s&&typeof s=="object"&&"message"in s){console.log(s);return}return s},Q=(s,e)=>{const d=o.value.data.find(c=>c.id===s);B({lead_id:d==null?void 0:d.id,lead_status_id:e}).patch(`/staffs/leads/${d==null?void 0:d.id}/status`,{preserveScroll:!0,preserveState:!0,onError:c=>{console.log(c)},onSuccess:c=>{m.value.isShow=!0;const R=c.props.flash;m.value.message=R.success||"Lead status updated successfully"}})},T=()=>{A.lead_ids=n.value,A.lead_status_id=g.value,A.patch("/staffs/leads/mass-update-status",{preserveState:!1,onError:s=>{console.log(s)},onSuccess:s=>{m.value.isShow=!0;const e=s.props.flash;m.value.message=e.success||"Bulk action completed successfully",C.value=!1,n.value=[],g.value=null}})},z=async s=>{S.value=s,$.value=!0,S.value&&(S.value.lead_notes=await O())},G=()=>ie({pagination:o,endpoint:"/admins/leads"}),J=()=>de({pagination:o,endpoint:"/admins/leads"});return(s,e)=>{const d=H("PlusSquare");return f(),b(ge,null,{default:l(()=>[i("div",we,[a(ae,{isShow:m.value.isShow,message:m.value.message,"onUpdate:isShow":e[0]||(e[0]=t=>m.value.isShow=t)},null,8,["isShow","message"]),a(ne,{open:$.value,selectedLead:S.value,"onUpdate:open":e[2]||(e[2]=t=>$.value=t)},{content:l(()=>[i("form",{onSubmit:K(D,["prevent"])},[e[9]||(e[9]=i("p",null,"Notes:",-1)),W(i("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>u(_).note=t),class:"w-full rounded-lg border-2 border-gray-300 p-2"},null,512),[[Z,u(_).note]]),u(_).errors.note?(f(),I("p",ke,y(u(_).errors.note),1)):k("",!0),a(fe,{class:"sm:justify-start"},{default:l(()=>[h.value?k("",!0):(f(),b(L,{key:0,type:"submit",variant:"default"},{default:l(()=>[a(u(ue)),e[8]||(e[8]=r(" Add Note "))]),_:1})),h.value?(f(),b(u(le),{key:1,class:"animate-spin"})):k("",!0)]),_:1})],32)]),_:1},8,["open","selectedLead"]),i("div",ye,[a(u(ee),{href:s.route("staffs.leads.create")},{default:l(()=>[a(L,{variant:"default",class:"w-full text-white"},{default:l(()=>[a(u(Se)),e[10]||(e[10]=r("Add Leads"))]),_:1})]),_:1},8,["href"]),a(oe,{onSubmit:T,open:C.value,"onUpdate:open":e[4]||(e[4]=t=>C.value=t)},{trigger:l(()=>[a(L,{variant:"secondary",class:"w-full"},{default:l(()=>[a(d),e[11]||(e[11]=r("Bulk Action"))]),_:1})]),content:l(()=>[i("div",xe,[a(pe,{class:"mb-1"},{default:l(()=>e[12]||(e[12]=[r("Status")])),_:1}),a(j,{"selected-id":g.value,"onUpdate:selectedId":[e[3]||(e[3]=t=>g.value=t),V],placeholder:"Select lead status",convertable:u(N)},null,8,["selected-id","convertable"]),u(_).errors.note?(f(),I("p",$e,y(u(_).errors.note),1)):k("",!0)])]),_:1},8,["open"])]),i("div",he,[a(me,{class:"w-full"},{default:l(()=>[a(_e,{class:"text-[12pt]"},{default:l(()=>[a(P,{class:"bg-[#F5F5F4] dark:bg-[#1C1C1A]"},{default:l(()=>[a(x,null,{default:l(()=>e[13]||(e[13]=[r("#")])),_:1}),a(x,null,{default:l(()=>e[14]||(e[14]=[r("Name")])),_:1}),a(x,null,{default:l(()=>e[15]||(e[15]=[r("Mobile")])),_:1}),a(x,null,{default:l(()=>e[16]||(e[16]=[r("Email")])),_:1}),a(x,null,{default:l(()=>e[17]||(e[17]=[r("Status")])),_:1})]),_:1})]),_:1}),a(ve,null,{default:l(()=>[(f(!0),I(se,null,te(o.value.data,t=>(f(),b(P,{key:t==null?void 0:t.id},{default:l(()=>[a(w,null,{default:l(()=>[a(ce,{type:"checkbox",class:"cursor-pointer",onClick:c=>M(t.id),checked:U(t.id)},null,8,["onClick","checked"])]),_:2},1024),a(w,{onClick:()=>z(t),class:"cursor-pointer"},{default:l(()=>[i("u",Ce,y(t.name),1)]),_:2},1032,["onClick"]),a(w,null,{default:l(()=>[r(y(t.mobile_number),1)]),_:2},1024),a(w,null,{default:l(()=>[r(y(t.email),1)]),_:2},1024),a(w,null,{default:l(()=>[(f(),b(j,{selectedId:t.lead_status_id,placeholder:"Select lead status",convertable:u(N),"onUpdate:selectedId":c=>Q(t.id,c),key:t.id},null,8,["selectedId","convertable","onUpdate:selectedId"]))]),_:2},1024)]),_:2},1024))),128)),o.value.data.length<1?(f(),b(P,{key:0},{default:l(()=>[a(w,{colspan:4,class:"w-full text-center"},{default:l(()=>e[18]||(e[18]=[r(" Your leads bucket empty ")])),_:1})]),_:1})):k("",!0)]),_:1})]),_:1})]),i("div",Ne,[i("div",Ae,[a(re,{current_page:o.value.current_page,last_page:o.value.last_page,per_page:o.value.per_page,next:G,prev:J,"onUpdate:current_page":e[5]||(e[5]=t=>o.value.current_page=t),"onUpdate:per_page":e[6]||(e[6]=t=>o.value.per_page=t),"onUpdate:last_page":e[7]||(e[7]=t=>o.value.last_page=t)},null,8,["current_page","last_page","per_page"])])])])]),_:1})}}});export{Xe as default};

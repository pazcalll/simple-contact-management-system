import{d as ee,n as se,y as v,C as L,z as te,g as x,o as r,w as a,b as d,e as s,i as le,A as ae,a as g,h as S,u as o,B as oe,t as k,f as n,P as ne,F as q,r as E}from"./app-DDH9-M8F.js";import{_ as ue}from"./SubmissionAlert.vue_vue_type_script_setup_true_lang-CEAN8wGM.js";import{L as re,_ as de,a as M}from"./GroupedSelect.vue_vue_type_script_setup_true_lang-Drq5abIC.js";import{_ as ie,P as fe,a as ce,h as pe,b as me}from"./TablePagination.vue_vue_type_script_setup_true_lang-BNkSDP0w.js";import{_ as _e}from"./ItemSelect.vue_vue_type_script_setup_true_lang-BI7Azg8d.js";import{_ as U}from"./index-Bl7ULf9p.js";import{e as ve}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-nlN60pnD.js";import{_ as O}from"./Input.vue_vue_type_script_setup_true_lang-DRq4L5js.js";import{_ as P}from"./Label.vue_vue_type_script_setup_true_lang-C1s4DYKS.js";import{_ as ge,a as Se,b as j,c as h,d as ke,e as w}from"./TableHeader.vue_vue_type_script_setup_true_lang-C-y_m1x9.js";import{_ as we}from"./AppLayout.vue_vue_type_script_setup_true_lang-DB6ZMh0f.js";import{C as be}from"./circle-plus-214mwmPS.js";import"./Alert.vue_vue_type_script_setup_true_lang-BDlI-3JF.js";import"./SelectContent.vue_vue_type_script_setup_true_lang-diDvTw5A.js";import"./useForwardPropsEmits-DhJmBs81.js";import"./useForwardExpose-fh6Ok7He.js";import"./RovingFocusGroup-B1ONIDe3.js";import"./x-CmkwNOn8.js";import"./check-CzJqFMvt.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DpgiMkX7.js";const ye=async D=>{const c=await fetch(`/managers/leads/${D}/lead-notes`,{headers:{"X-Request-Format":"json"}});let $=null;return c.ok?($=await c.json(),console.log("Lead Notes Data:",$),$):await c.json()},xe={class:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4"},he={key:0,class:"text-red-500"},$e={class:"grid grid-cols-5 gap-2"},Ce={class:"w-full"},Ne={key:0,class:"text-red-500"},Ae={class:"w-full"},Ie={key:0,class:"text-red-500"},Be={class:"flex w-full items-center justify-start"},Le={class:"flex items-center"},Ue={class:"w-full rounded-lg border"},Pe={class:"text-blue-500"},je={key:0},De={class:"flex w-full justify-center"},Fe={class:"w-full max-w-[14rem]"},ls=ee({__name:"Leads",setup(D){const c=se();console.log(c.props);const $=v(c.props.supervisor),f=v(c.props.leads),N=v(!1),A=v(!1),p=v({isShow:!1,message:null}),I=v(!1),u=v([]),b=v(null),F=v(null),y=v(null),B=c.props.leadStatuses,m=L({note:null}),C=L({lead_status_id:null,lead_ids:[],supervisor_id:null,is_unassign:"off"}),Q=async()=>{var l;A.value=!0,m.submit("post",`/managers/leads/${(l=y.value)==null?void 0:l.id}/lead-notes`,{onBefore:e=>{console.log(e)},onSuccess:()=>{N.value=!1,p.value.isShow=!0;const e=c.props.flash;p.value.message=e.success||"Note added successfully",m.reset()},onFinish:()=>{A.value=!1}})},T=async l=>{const e=B.find(_=>_.id==l);b.value=e==null?void 0:e.id,console.log(b.value)},z=l=>{u.value?u.value.includes(l)||(u.value=[...u.value,l]):u.value=[l]},G=l=>{u.value&&(u.value=u.value.filter(e=>e!==l),u.value.length===0&&(u.value=[]))},V=l=>u.value.includes(l),J=l=>{const e=V(l);e?G(l):e?console.log("unidentified action"):z(l)},R=async()=>{var e;const l=await ye(((e=y.value)==null?void 0:e.id)??0);if(l&&typeof l=="object"&&"message"in l){console.log(l);return}return l},X=(l,e)=>{const _=f.value.data.find(i=>i.id===l);L({lead_id:_==null?void 0:_.id,lead_status_id:e}).patch(`/managers/leads/${_==null?void 0:_.id}/status`,{preserveScroll:!0,preserveState:!0,onError:i=>{console.log(i)},onSuccess:i=>{p.value.isShow=!0;const Z=i.props.flash;p.value.message=Z.success||"Lead status updated successfully"}})},Y=()=>{C.lead_ids=u.value,C.lead_status_id=b.value,C.supervisor_id=F.value,C.patch("/managers/leads/bulk-assign-leads",{preserveState:!1,onError:l=>{console.log(l)},onSuccess:l=>{p.value.isShow=!0;const e=l.props.flash;p.value.message=e.success||"Bulk action completed successfully",p.value.isShow=!0,I.value=!1,u.value=[],b.value=null}})},H=async l=>{y.value=l,console.log(l),N.value=!0,y.value&&(y.value.lead_notes=await R())},K=()=>me({pagination:f,endpoint:"/admins/leads"}),W=()=>pe({pagination:f,endpoint:"/admins/leads"});return(l,e)=>{const _=te("PlusSquare");return r(),x(we,null,{default:a(()=>[d("div",xe,[s(ue,{isShow:p.value.isShow,message:p.value.message,"onUpdate:isShow":e[0]||(e[0]=t=>p.value.isShow=t)},null,8,["isShow","message"]),s(ie,{open:N.value,selectedLead:y.value,"onUpdate:open":e[2]||(e[2]=t=>N.value=t)},{content:a(()=>[d("form",{onSubmit:le(Q,["prevent"])},[e[11]||(e[11]=d("p",null,"Notes:",-1)),ae(d("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>o(m).note=t),class:"w-full rounded-lg border-2 border-gray-300 p-2"},null,512),[[oe,o(m).note]]),o(m).errors.note?(r(),g("p",he,k(o(m).errors.note),1)):S("",!0),s(ve,{class:"sm:justify-start"},{default:a(()=>[A.value?S("",!0):(r(),x(U,{key:0,type:"submit",variant:"default"},{default:a(()=>[s(o(fe)),e[10]||(e[10]=n(" Add Note "))]),_:1})),A.value?(r(),x(o(re),{key:1,class:"animate-spin"})):S("",!0)]),_:1})],32)]),_:1},8,["open","selectedLead"]),d("div",$e,[s(o(ne),{href:l.route("managers.leads.create")},{default:a(()=>[s(U,{variant:"default",class:"w-full text-white"},{default:a(()=>[s(o(be)),e[12]||(e[12]=n("Add Leads"))]),_:1})]),_:1},8,["href"]),s(de,{onSubmit:Y,open:I.value,"onUpdate:open":e[6]||(e[6]=t=>I.value=t)},{trigger:a(()=>[s(U,{variant:"secondary",class:"w-full"},{default:a(()=>[s(_),e[13]||(e[13]=n("Bulk Action"))]),_:1})]),content:a(()=>[d("div",Ce,[s(P,{class:"mb-1"},{default:a(()=>e[14]||(e[14]=[n("Status")])),_:1}),s(M,{"selected-id":b.value,"onUpdate:selectedId":[e[3]||(e[3]=t=>b.value=t),T],placeholder:"Select lead status",convertable:o(B)},null,8,["selected-id","convertable"]),o(m).errors.note?(r(),g("p",Ne,k(o(m).errors.note),1)):S("",!0)]),d("div",Ae,[s(P,{class:"mb-1"},{default:a(()=>e[15]||(e[15]=[n("Supervisor")])),_:1}),s(_e,{placeholder:"Select supervisor",items:$.value,"onUpdate:selectedId":e[4]||(e[4]=t=>F.value=t)},null,8,["items"]),o(m).errors.note?(r(),g("p",Ie,k(o(m).errors.note),1)):S("",!0)]),d("div",Be,[d("div",Le,[s(P,{class:"ml-2 cursor-pointer"},{default:a(()=>[s(O,{type:"checkbox",class:"shadow-none",onClick:e[5]||(e[5]=t=>o(C).is_unassign=t.target.checked?"on":"off")}),e[16]||(e[16]=n(" Unassign "))]),_:1})])])]),_:1},8,["open"])]),d("div",Ue,[s(ge,{class:"w-full"},{default:a(()=>[s(Se,{class:"text-[12pt]"},{default:a(()=>[s(j,{class:"bg-[#F5F5F4] dark:bg-[#1C1C1A]"},{default:a(()=>[s(h,null,{default:a(()=>e[17]||(e[17]=[n("#")])),_:1}),s(h,null,{default:a(()=>e[18]||(e[18]=[n("Name")])),_:1}),s(h,null,{default:a(()=>e[19]||(e[19]=[n("Mobile")])),_:1}),s(h,null,{default:a(()=>e[20]||(e[20]=[n("Email")])),_:1}),s(h,null,{default:a(()=>e[21]||(e[21]=[n("Status")])),_:1}),s(h,null,{default:a(()=>e[22]||(e[22]=[n("Assignees")])),_:1})]),_:1})]),_:1}),s(ke,null,{default:a(()=>[(r(!0),g(q,null,E(f.value.data,t=>(r(),x(j,{key:t==null?void 0:t.id},{default:a(()=>[s(w,null,{default:a(()=>[s(O,{type:"checkbox",class:"cursor-pointer",onClick:i=>J(t.id),checked:V(t.id)},null,8,["onClick","checked"])]),_:2},1024),s(w,{onClick:()=>H(t),class:"cursor-pointer"},{default:a(()=>[d("u",Pe,k(t.name),1)]),_:2},1032,["onClick"]),s(w,null,{default:a(()=>[n(k(t.mobile_number),1)]),_:2},1024),s(w,null,{default:a(()=>[n(k(t.email),1)]),_:2},1024),s(w,null,{default:a(()=>[(r(),x(M,{selectedId:t.lead_status_id,placeholder:"Select lead status",convertable:o(B),"onUpdate:selectedId":i=>X(t.id,i),key:t.id},null,8,["selectedId","convertable","onUpdate:selectedId"]))]),_:2},1024),s(w,null,{default:a(()=>[(r(!0),g(q,null,E(t.users,i=>(r(),g("ul",{key:i.id,class:"list-inside list-disc"},[i.id!=o(c).props.auth.user.id?(r(),g("li",je,k(i.name),1)):S("",!0)]))),128))]),_:2},1024)]),_:2},1024))),128)),f.value.data.length<1?(r(),x(j,{key:0},{default:a(()=>[s(w,{colspan:4,class:"w-full text-center"},{default:a(()=>e[23]||(e[23]=[n(" Your leads bucket empty ")])),_:1})]),_:1})):S("",!0)]),_:1})]),_:1})]),d("div",De,[d("div",Fe,[s(ce,{current_page:f.value.current_page,last_page:f.value.last_page,per_page:f.value.per_page,next:K,prev:W,"onUpdate:current_page":e[7]||(e[7]=t=>f.value.current_page=t),"onUpdate:per_page":e[8]||(e[8]=t=>f.value.per_page=t),"onUpdate:last_page":e[9]||(e[9]=t=>f.value.last_page=t)},null,8,["current_page","last_page","per_page"])])])])]),_:1})}}});export{ls as default};
